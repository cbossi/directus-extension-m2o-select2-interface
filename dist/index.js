import{useStores as e,useItems as t,defineInterface as l}from"@directus/extensions-sdk";import{defineComponent as n,ref as a,watch as i,resolveComponent as o,openBlock as r,createElementBlock as s,createElementVNode as u,createBlock as c,withCtx as d,createVNode as p,Fragment as m,renderList as f,createTextVNode as v,toDisplayString as y,createCommentVNode as h}from"vue";const g=/({{.*?}})/g;class S{constructor(e){this.displayTemplate=e}apply(e){return this.displayTemplate.split(g).map((t=>{if(!t.startsWith("{{"))return t;const l=t.replace(/{{/g,"").replace(/}}/g,"").trim(),n=e[l];return void 0===n?`<${l}>`:null===n?"":n})).join("")}}class b{constructor(e,t){var l,n;this.primaryKeyColumn=null==(l=e.schema)?void 0:l.foreign_key_column;const a=null==(n=t.meta)?void 0:n.display_template;this.displayTemplate=a?new S(a):void 0}getText(e){return this.displayTemplate?this.displayTemplate.apply(e):this.getValue(e)}getValue(e){return this.primaryKeyColumn?e[this.primaryKeyColumn]:JSON.stringify(e)}}const x="input";var V=n({props:{value:{type:Number,default:null},collection:{type:String},field:{type:String},fieldData:Object,template:String},emits:[x],setup(l,{emit:n}){const o=l.fieldData.meta.readonly,{useRelationsStore:r,useCollectionsStore:s}=e(),u=r(),c=s(),d=u.getRelationsForField(l.collection,l.field)[0],p=c.getCollection(d.related_collection),m=new b(d,p),{items:f,loading:v}=t(a(d.related_collection),{fields:a(["*"]),limit:a(-1),sort:a(null),search:a(""),filter:a(null),page:a(1)}),y=a(),h=a(l.value),g=a(""),S=a("");return i(f,(e=>{y.value=e.map((e=>({value:m.getValue(e),text:m.getText(e)}))),V()}),{immediate:!0}),{loading:v,readonly:o,allOptions:y,filterValue:S,selectedText:g,onSearchValueChanged:function(e){S.value=e},setSelectedValue:function(e){h.value=e,V(),n(x,e)},clearSearchValue:function(e){const t=e.target,l=C();t.value!==l&&(t.value=l||"")}};function V(){g.value=C()}function C(){var e;return null==(e=y.value.find((e=>e.value===h.value)))?void 0:e.text}},methods:{filteredOptions(){return this.readonly?[]:this.filterValue?this.allOptions.filter((e=>e.text.toLowerCase().includes(this.filterValue.toLowerCase()))):this.allOptions}}});const C={class:"wrapper"},T={class:"delete-wrapper"};var _=[],O=[];!function(e,t){if(e&&"undefined"!=typeof document){var l,n=!0===t.prepend?"prepend":"append",a=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(a){var o=_.indexOf(i);-1===o&&(o=_.push(i)-1,O[o]={}),l=O[o]&&O[o][n]?O[o][n]:O[o][n]=r()}else l=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),l.styleSheet?l.styleSheet.cssText+=e:l.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var l=Object.keys(t.attributes),a=0;a<l.length;a++)e.setAttribute(l[a],t.attributes[l[a]]);var o="prepend"===n?"afterbegin":"beforeend";return i.insertAdjacentElement(o,e),e}}("\n.wrapper {\n  position: relative;\n}\n.delete-wrapper {\n  position: absolute;\n  right: 1rem;\n  top: 0;\n  bottom: 0;\n  z-index: 1;\n  font-weight: bold;\n  display: flex;\n  align-items: center;\n}\n.delete {\n  font-size: 1.25rem;\n  color: #d3dae4;\n}\n.delete:hover {\n  color: #a2b5cd;\n}\n\n",{}),V.render=function(e,t,l,n,a,i){const g=o("v-input"),S=o("v-list-item-content"),b=o("v-list-item"),x=o("v-list"),V=o("v-menu");return r(),s("div",C,[u("div",T,[u("button",{class:"delete",onClick:t[0]||(t[0]=t=>e.setSelectedValue(null))},"x")]),e.loading?h("v-if",!0):(r(),c(V,{key:0,attached:""},{activator:d((({activate:l})=>[p(g,{readonly:e.readonly,"model-value":e.selectedText,"onUpdate:modelValue":e.onSearchValueChanged,onFocus:l,onBlur:t[1]||(t[1]=t=>e.clearSearchValue(t))},null,8,["readonly","model-value","onUpdate:modelValue","onFocus"])])),default:d((()=>[e.filteredOptions().length>0?(r(),c(x,{key:0},{default:d((()=>[(r(!0),s(m,null,f(e.filteredOptions(),(t=>(r(),c(b,{key:t.value,clickable:"",onClick:()=>e.setSelectedValue(t.value)},{default:d((()=>[p(S,null,{default:d((()=>[v(y(t.text),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):h("v-if",!0)])),_:1}))])},V.__file="src/interface.vue";var k=l({id:"m2o-select2-interface",name:"Many to One Select2",icon:"view_stream",description:"Select2 for many to one fields",component:V,options:null,group:"relational",types:["alias"],localTypes:["m2o"],relational:!0});export{k as default};
